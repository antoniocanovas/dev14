<odoo>
        <record id="donation_purchase_create" model="ir.actions.server">
            <field name="name">=> Donation purchase line creation</field>
            <field ref="model_product_template" name="model_id" />
            <field name="binding_model_id" ref="model_purchase_order"/>
            <field name="state">code</field>
            <field name="code">
# Crea la CLASIFICACIÓN y desglose de productos en la ubicación del producto padre:
for r in records:
  newsi = False
  rootcode = r.default_code[:6]
  location = env['stock.location'].search([('name','=',rootcode)])
  rootpt = env['product.template'].search([('default_code','=',rootcode)])
  if not rootpt.id or not location.id:
    raise Warning('Revisa los códigos de los productos padre anidados, no encuentro el raiz con los 6 primeros dígitos; o la localizacón de almacén con este código.')

  for li in r.unbuild_product_line_ids:
    if not li.newproduct_id.id:
      codesub = str(rootpt.unbuild_sequence + 1001)[-3:]
      newproduct = env['product.template'].create({'name':li.name,
        # 'chassis_pt':r.chassis_pt,
        'categ_id':li.part_id.category_id.id, 'unbuild_type':'subproduct',
        'sale_ok':True, 'purchase_ok':False, 'type':'product', 'parent_id':rootpt.id, 'default_code':rootcode + codesub,
        'income_analytic_account_id':rootpt.income_analytic_account_id.id , 'expense_analytic_account_id':rootpt.expense_analytic_account_id.id,
        'unbuild_location_id':rootpt.unbuild_location_id.id})
      rootpt['unbuild_sequence'] = rootpt.unbuild_sequence +1
      newproductproduct = env['product.product'].search([('product_tmpl_id','=',newproduct.id)])

      if (newsi == False):
        name = "Productos " + rootpt.default_code
        newsi = env['stock.inventory'].create({'name':name})
      newsil = env['stock.inventory.line'].create({'inventory_id':newsi.id, 'location_id':location.id, 'product_id':newproductproduct.id,
        'product_qty':li.qty})
      li['newproduct_id'] = newproduct.id
  if (newsi != False):
    newsi.action_start()
    newsi.action_validate()
  else:
    raise Warning('No hay productos nuevos que crear en: ' + r.name)
            </field>
        </record>

        <record id="update_donation_set_lines" model="base.automation">
            <field name="name">=> Update donation set lines</field>
            <field name="model_id" ref="model_purchase_order"/>
            <field name="state">code</field>
            <field name="code">
# CODE:
record.donation_line_ids.unlink()
for line in record.donation_set_id.line_ids:
  newline = env['donation.line'].create({'product_id':line.product_id.id, 'qty':line.qty, 'name':line.product_id.name, 'purchase_id':record.id})

            </field>
            <field name="trigger">on_change</field>
            <field name="on_change_field_ids" eval="[(6,0, [ref('purchase_donation.field_purchase_order__donation_set_id')])]"/>
            <field name="filter_pre_domain"></field>
            <field name="filter_domain"></field>
            <field name="active" eval="True"/>
        </record>

</odoo>
