<odoo>
        <record id="donation_purchase_create" model="ir.actions.server">
            <field name="name">=> Donation purchase line creation</field>
            <field ref="model_purchase_order" name="model_id" />
            <field name="binding_model_id" ref="model_purchase_order"/>
            <field name="state">code</field>
            <field name="code">
# Crea las líneas de compra con nuevos productos seriados por el código de compra:
# El producto es siempre nuevo, pero puede haber distintos en el set, poner otro sufijo

for r in records:
  donation_code = r.name

  for li in r.donation_line_ids:
    if not li.purchase_line_id.id:
      similar_product = env['purchase.order.line'].search([('product_id.parent_id','=', li.product_id.parent_id.id), ('order_id','=',record.id)])
      new_product = env['product.template'].create({'name':li.name + " " + donation_code, 'categ_id':li.product_id.categ_id.id,
      'sale_ok':True, 'purchase_ok':True, 'type':'product', 'parent_id':record.id})

      new_productproduct = env['product.product'].search([('product_tmpl_id','=',new_product.id)])

      new_pol = env['purchase.order.line'].create({'order_id':record.id, 'product_id':new_productproduct.id, 'product_qty': li.qty,
        'product_uom':li.product_id.uom_po_id.id, 'price_unit':1})

      li.write({'newproduct_id':new_product.id, 'purchase_line_id':new_pol.id})

            </field>
        </record>

        <record id="update_donation_set_lines" model="base.automation">
            <field name="name">=> Update donation set lines</field>
            <field name="model_id" ref="model_purchase_order"/>
            <field name="state">code</field>
            <field name="code">
record.donation_line_ids.unlink()
for line in record.donation_set_id.line_ids:
  newline = env['donation.line'].create({'product_id':line.product_id.id, 'qty':line.qty, 'name':line.product_id.name, 'purchase_id':record.id})

            </field>
            <field name="trigger">on_change</field>
            <field name="on_change_field_ids" eval="[(6,0, [ref('purchase_donation.field_purchase_order__donation_set_id')])]"/>
            <field name="filter_pre_domain"></field>
            <field name="filter_domain"></field>
            <field name="active" eval="True"/>
        </record>

</odoo>
