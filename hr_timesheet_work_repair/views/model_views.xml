<?xml version='1.0' encoding='UTF-8'?>
<odoo>

    <record id="timesheet_work_form_inh_repair" model="ir.ui.view">
        <field name="name">Extended work repair inh</field>
        <field name="model">work.sheet</field>
        <field name="inherit_id" ref="hr_timesheet_work.work_sheet_form"/>
        <field name="arch" type="xml">
            <field name="work_id" position="after">
                <field name="repair_id" domain="[('id','in',repair_ids)]" attrs="{'invisible':[('type','!=','repair')], 'required':[('type','=','repair')]}" options="{'no_create': True}"/>
            </field>
            <xpath expr="//group[@name='work_sheet_main']" position="after">
                <div attrs="{'invisible':['|',('type','!=','repair'),('repair_id','!=',False)]}">
                    <h3>Active repairs:</h3>
                    <field name="repair_ids"/>
                </div>
            </xpath>
            <xpath expr="//page[@name='work_sheet_project_products']" position="after">
                <page name="wor_sheet_repair_products" string="Repair parts" attrs="{'invisible':[('type','!=','repair')]}">
                    <field name="repair_product_ids" attrs="{'readonly':[('repair_id','=',False)]}" context="{'default_repair_id':repair_id, 'default_location_id':repair_location_id, 'default_company_id': company_id}">
                        <tree string="Operations" editable="bottom">
                            <field name="company_id" invisible="1" force_save="1"/>
                            <field name="type" options="{'no_create': True}"/>
                            <field name="product_id" options="{'no_create': True}"/>
                            <field name="name" optional="show"/>
                            <field name="product_uom_category_id" invisible="1"/>
                            <field name="lot_id" context="{'default_product_id': product_id, 'default_company_id': company_id}" groups="stock.group_production_lot"/>
                            <field name="location_id" options="{'no_create': True}" groups="stock.group_stock_multi_locations" optional="show"/>
                            <field name="location_dest_id" options="{'no_create': True}" groups="stock.group_stock_multi_locations" optional="show"/>
                            <field name="product_uom_qty" string="Quantity"/>
                            <field name="product_uom" string="UoM" groups="uom.group_uom" optional="show"/>
                            <field name="repair_id" invisible="1"/>
                            <field name="price_unit" invisible="1"/>
                            <field name="tax_id" widget="many2many_tags" invisible="1"/>
                            <field name="price_subtotal" widget="monetary" invisible="1"/>
                            <field name="repair_id" invisible="1"/>
                            <field name="currency_id" invisible="1"/>
                        </tree>
                    </field>
                    <field name="repair_location_id" invisible="1"/>
                </page>
            </xpath>
        </field>
    </record>

    <record id="timesheet_work_sheet_tree_search" model="ir.ui.view">
        <field name="name">timesheet.work.sheet.tree.search</field>
        <field name="model">work.sheet</field>
        <field name="inherit_id" ref="hr_timesheet_work.work_sheet_tree_search"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='type_project']" position="after">
                <filter string="Repairs" name="type_repair" domain="[('type', '=', 'repair')]"/>
            </xpath>
        </field>
    </record>



</odoo>
